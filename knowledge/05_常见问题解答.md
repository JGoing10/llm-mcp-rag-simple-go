# 常见问题解答 (FAQ)

## 安装和配置问题

### Q1: 程序启动时提示 "OPENAI_API_KEY 不能为空"
**问题**：
```
配置验证失败：OPENAI_API_KEY 不能为空
```

**解决方案**：
1. 确保 `.env` 文件存在于项目根目录
2. 检查 `.env` 文件中是否正确设置了 `OPENAI_API_KEY`
3. 确保API密钥没有多余的空格或引号
4. 验证API密钥是否有效

**正确配置示例**：
```env
OPENAI_API_KEY=sk-your-actual-api-key-here
OPENAI_BASE_URL=https://api.deepseek.com/v1
OPENAI_MODEL=deepseek-chat
```

### Q2: 提示 "No knowledge directory found"
**问题**：
```
No knowledge directory found, skipping knowledge base loading
```

**解决方案**：
1. 在项目根目录创建 `knowledge` 文件夹
2. 添加 `.md` 或 `.txt` 格式的知识文档
3. 重启程序，系统会自动加载文档

**目录结构示例**：
```
llm-mcp-rag-simple/
├── knowledge/
│   ├── 01_项目介绍.md
│   ├── 02_快速开始.md
│   └── 03_API配置.md
└── ...
```

### Q3: Go版本兼容性问题
**问题**：
```
go: module requires Go 1.21 or later
```

**解决方案**：
1. 检查Go版本：`go version`
2. 升级Go到1.21或更高版本
3. 重新运行 `go mod download`

**升级Go**：
- 访问 https://golang.org/dl/
- 下载最新版本
- 按照安装指南进行升级

## API相关问题

### Q4: API调用失败，提示网络错误
**问题**：
```
Error: connection timeout / network unreachable
```

**解决方案**：
1. **检查网络连接**：确保能访问API服务器
2. **使用代理**：如果需要，配置HTTP代理
3. **更换API服务商**：尝试使用国内服务商
4. **增加超时时间**：在 `.env` 中设置 `TIMEOUT_SECONDS=60`

**代理配置示例**：
```bash
export HTTP_PROXY=http://proxy.company.com:8080
export HTTPS_PROXY=http://proxy.company.com:8080
```

### Q5: API密钥无效或余额不足
**问题**：
```
Error: invalid API key / insufficient quota
```

**解决方案**：
1. **验证API密钥**：登录服务商控制台检查密钥状态
2. **检查余额**：确保账户有足够余额
3. **检查权限**：确认API密钥有相应权限
4. **重新生成密钥**：如果密钥过期，生成新的密钥

### Q6: 模型不存在或无权限访问
**问题**：
```
Error: model not found / model not available
```

**解决方案**：
1. **检查模型名称**：确保模型名称拼写正确
2. **查看可用模型**：登录服务商控制台查看可用模型列表
3. **升级账户**：某些模型可能需要付费账户
4. **更换模型**：使用其他可用的模型

**常用模型名称**：
- DeepSeek: `deepseek-chat`
- 通义千问: `qwen-turbo`, `qwen-plus`, `qwen-max`
- 智谱AI: `glm-4`, `glm-3-turbo`
- OpenAI: `gpt-4`, `gpt-3.5-turbo`

## 功能使用问题

### Q7: 知识库检索效果不好
**问题**：检索到的文档不相关或检索不到内容

**解决方案**：
1. **优化文档内容**：
   - 使用清晰的标题和结构
   - 添加关键词和摘要
   - 避免过长的段落

2. **调整检索参数**：
   - 增加检索的文档数量
   - 使用更好的嵌入模型
   - 优化查询关键词

3. **选择合适的嵌入模型**：
   - 中文内容：`BAAI/bge-large-zh-v1.5`
   - 英文内容：`text-embedding-3-large`
   - 多语言：`BAAI/bge-m3`

### Q8: MCP工具无法使用
**问题**：提示MCP客户端初始化失败

**解决方案**：
1. **安装MCP服务器**：
   ```bash
   npm install -g @modelcontextprotocol/server-filesystem
   npm install -g @modelcontextprotocol/server-fetch
   ```

2. **检查命令路径**：确保MCP服务器在PATH中
3. **验证配置**：检查 `main.go` 中的MCP配置
4. **查看日志**：启用调试模式查看详细错误信息

### Q9: 响应速度慢
**问题**：AI回复需要很长时间

**解决方案**：
1. **选择更快的API服务商**：
   - DeepSeek: 响应快，价格低
   - 通义千问: 国内访问快
   - 本地模型: 无网络延迟

2. **优化配置**：
   ```env
   TIMEOUT_SECONDS=30
   MAX_RETRIES=1
   ```

3. **减少上下文长度**：
   - 清理对话历史
   - 减少检索的文档数量
   - 使用更短的系统提示词

4. **使用更快的模型**：
   - `deepseek-chat` 而不是 `gpt-4`
   - `qwen-turbo` 而不是 `qwen-max`

## 开发和调试问题

### Q10: 如何启用调试模式？
**配置调试**：
```env
DEBUG=true
LOG_LEVEL=debug
```

**查看详细日志**：
```bash
go run main.go 2>&1 | tee debug.log
```

**调试特定组件**：
```env
# MCP调试
MCP_DEBUG=true

# 嵌入调试
EMBEDDING_DEBUG=true

# 向量存储调试
VECTORSTORE_DEBUG=true
```

### Q11: 如何添加自定义功能？
**添加新的工具**：
1. 实现 `MCPClient` 接口
2. 在 `initializeMCPClients` 中注册
3. 测试工具功能

**添加新的嵌入模型**：
1. 修改 `embedding/embedding.go`
2. 添加新的API调用逻辑
3. 更新配置文档

**扩展向量存储**：
1. 实现 `VectorStore` 接口
2. 添加持久化存储
3. 优化搜索算法

### Q12: 如何贡献代码？
**贡献流程**：
1. Fork项目仓库
2. 创建功能分支
3. 编写代码和测试
4. 提交Pull Request

**代码规范**：
- 遵循Go代码规范
- 添加详细的中文注释
- 编写单元测试
- 更新相关文档

## 性能优化问题

### Q13: 内存使用过高
**问题**：程序运行时内存占用过大

**解决方案**：
1. **限制向量存储大小**：定期清理旧文档
2. **优化嵌入缓存**：设置合理的缓存大小
3. **减少并发数**：降低同时处理的请求数
4. **使用流式处理**：对大文档进行分块处理

### Q14: 如何提高并发性能？
**优化建议**：
1. **增加连接池大小**：
   ```go
   client := &http.Client{
       Transport: &http.Transport{
           MaxIdleConns:        100,
           MaxIdleConnsPerHost: 10,
       },
   }
   ```

2. **使用goroutine池**：限制并发goroutine数量
3. **实现请求批处理**：批量处理嵌入请求
4. **添加缓存层**：缓存常用的查询结果

## 部署相关问题

### Q15: 如何部署到生产环境？
**部署步骤**：
1. **构建二进制文件**：
   ```bash
   go build -o llm-mcp-rag cmd/main.go
   ```

2. **配置环境变量**：
   ```bash
   export OPENAI_API_KEY=your-key
   export EMBEDDING_KEY=your-key
   ```

3. **设置系统服务**：
   ```ini
   [Unit]
   Description=LLM MCP RAG Service
   After=network.target

   [Service]
   Type=simple
   User=app
   WorkingDirectory=/opt/llm-mcp-rag
   ExecStart=/opt/llm-mcp-rag/llm-mcp-rag
   Restart=always

   [Install]
   WantedBy=multi-user.target
   ```

4. **配置反向代理**：使用Nginx或Traefik

### Q16: 如何监控应用状态？
**监控方案**：
1. **健康检查端点**：添加HTTP健康检查
2. **日志监控**：使用ELK或类似工具
3. **指标收集**：集成Prometheus
4. **告警设置**：配置告警规则

**示例健康检查**：
```go
http.HandleFunc("/health", func(w http.ResponseWriter, r *http.Request) {
    w.WriteHeader(http.StatusOK)
    w.Write([]byte("OK"))
})
```

## 获取帮助

### 技术支持渠道
1. **GitHub Issues**：报告bug和功能请求
2. **文档**：查看详细的API文档和配置指南
3. **社区论坛**：与其他用户交流经验
4. **官方文档**：查看MCP和相关技术的官方文档

### 有用的资源
- **MCP官方文档**：https://modelcontextprotocol.io/
- **Go官方文档**：https://golang.org/doc/
- **OpenAI API文档**：https://platform.openai.com/docs/
- **项目GitHub**：查看最新代码和问题

### 报告问题时请提供
1. **错误信息**：完整的错误日志
2. **环境信息**：Go版本、操作系统
3. **配置信息**：相关的配置设置（隐藏敏感信息）
4. **复现步骤**：详细的问题复现步骤